# T7 - InstantID 參數測試執行指南

**測試類型**: 選項 B（快速測試）  
**測試數量**: 3 張圖  
**預估費用**: ~$0.11  
**預估時間**: 5-10 分鐘

---

## 🚀 執行步驟

### 1. 打開終端機

進入 backend 目錄：

```bash
cd /Users/brunella/.openclaw/workspace/virtual-prism/backend
```

---

### 2. 確認環境

檢查 API Token（應該已設定好）：

```bash
grep "REPLICATE_API_TOKEN" .env
```

應該看到：`REPLICATE_API_TOKEN=r8_xxx...`

---

### 3. 執行測試腳本

```bash
python scripts/test_instantid_quick.py
```

---

### 4. 測試過程

腳本會顯示：

```
🚀 InstantID 快速測試（選項 B）
============================================================
📁 輸出目錄: test_results/instantid_quick_20260225_XXXXXX
🎯 測試數量: 3 張圖
💰 預估費用: 約 $0.11 (3 × $0.037)
⏱️  預估時間: 5-10 分鐘
============================================================

⚠️  確認資訊:
   測試數量: 3 張圖
   預估費用: 約 $0.11
   預估時間: 5-10 分鐘

開始測試？(Y/n):
```

輸入 `Y` 或直接按 Enter 開始。

---

### 5. 等待生成

腳本會依序測試 3 個參數（0.6, 0.8, 1.0），每個參數生成 1 張圖：

```
🔬 測試參數: controlnet_conditioning_scale = 0.6
   場景: gym_flash (閃光燈健身房)
   Seed: 42
   生成中...
   ✅ 完成！
   圖片: https://replicate.delivery/...

   ⏳ 等待 3 秒...

🔬 測試參數: controlnet_conditioning_scale = 0.8
   ...
```

---

### 6. 查看結果

測試完成後，腳本會顯示對比表格：

```
============================================================
📊 測試結果對比
============================================================

參數 0.6:
  https://replicate.delivery/yhqm/.../output-0.png

參數 0.8:
  https://replicate.delivery/yhqm/.../output-1.png

參數 1.0:
  https://replicate.delivery/yhqm/.../output-2.png

============================================================
✅ 測試完成！
   成功: 3/3
   報告: test_results/instantid_quick_XXXXXX/report.json

💡 下一步:
   1. 打開上面的圖片 URL，肉眼對比
   2. 評估人臉一致性和真實感
   3. 選擇最佳參數值
============================================================
```

---

## 📊 評估標準

對比 3 張圖時，請注意：

### 人臉一致性
- ✅ **好**: 三張圖明顯是同一個人，五官比例一致
- ⚠️ **中等**: 看起來相似，但有些細節不同
- ❌ **差**: 看起來像不同的人

### 真實感
- ✅ **好**: 看起來像真人手機照片，有自然瑕疵
- ⚠️ **中等**: 有點真實感，但還是能看出是 AI
- ❌ **差**: 明顯的 AI 感、塑膠感

### 參數影響
- **0.6**: 人臉一致性較弱，但真實感可能更高（更多變化）
- **0.8**: 平衡點（當前預設值）
- **1.0**: 人臉一致性最強，但可能過於完美（塑膠感）

---

## 📁 輸出檔案

測試完成後會生成：

```
test_results/instantid_quick_YYYYMMDD_HHMMSS/
└── report.json  # 完整測試報告（包含所有圖片 URL）
```

可以用文字編輯器打開 `report.json` 查看詳細資訊。

---

## 🎯 下一步

測試完成並選定最佳參數後，告訴我：

- **最佳參數值**: 0.6 / 0.8 / 1.0
- **原因**: 人臉一致性如何？真實感如何？

我會立即更新系統的預設參數（T8），然後進行端到端測試（T11）。

---

## ❓ 常見問題

### Q: 圖片 URL 打不開？
A: Replicate 的圖片 URL 有效期約 24 小時，請在測試完成後立即查看。

### Q: 看不出明顯差異？
A: 差異可能很微妙，建議：
1. 放大看人臉細節（眼睛、鼻子、嘴巴）
2. 對比髮際線、臉型輪廓
3. 若真的差不多，就用預設值 0.8

### Q: 想測試其他場景？
A: 可以修改 `test_instantid_quick.py` 的 `TEST_SCENARIO`，改成 `outdoor_park` 或 `cafe_casual`。

---

**準備好了！隨時可以執行。**
